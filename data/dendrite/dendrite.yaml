version: 2

global:
  # Stable local-only server name
  server_name: vento.local

  # Path to the Matrix signing key (generated by Vento on first run)
  private_key: ../../data/dendrite/matrix_key.pem

  # Completely disable federation for offline/local use
  disable_federation: true

  # Main SQLite database (single-DB setup for stability)
  database:
    connection_string: file:../../data/dendrite/dendrite_main.db
    max_open_conns: 20
    max_idle_conns: 2
    conn_max_lifetime: -1

  # Disable all remote stats reporting
  report_stats:
    enabled: false

  # Disable server notices (no auto-created rooms)
  server_notices:
    enabled: false

  # Disable presence (not useful locally, reduces noise)
  presence:
    enable_inbound: false
    enable_outbound: false

  # JetStream (local, persistent, no TLS)
  jetstream:
    storage_path: ../../data/dendrite/jetstream
    in_memory: false
    disable_tls_validation: true
    addresses: []
    topic_prefix: Vento

  # Disable Prometheus metrics
  metrics:
    enabled: false

logging:
  - type: std
    level: info

# ==========================================================
# CLIENT API  (Required for user registration in Vento.local)
# ==========================================================

client_api:
  # Allow local user sign-ups
  registration_disabled: false

  # No tokens or shared secrets required
  registration_requires_token: false
  registration_shared_secret: ""

  # No CAPTCHA, no guests
  enable_registration_captcha: false
  guests_disabled: true

  # Disable rate limiting for local use
  rate_limiting:
    enabled: false

  allowed_registration_origins:
    - "127.0.0.1"
    - "::1"

# ======================
# KEY SERVER
# ======================

key_server:
  database:
    connection_string: file:../../data/dendrite/dendrite_keyserver.db
    max_open_conns: 20
    max_idle_conns: 2
    conn_max_lifetime: -1

# ======================
# MEDIA API  (Optional)
# ======================

media_api:
  database:
    connection_string: file:../../data/dendrite/dendrite_media.db
  base_path: ../../data/dendrite/media
  max_file_size_bytes: 10485760
  dynamic_thumbnails: false

# ======================
# ROOM SERVER
# ======================

room_server:
  database:
    connection_string: file:../../data/dendrite/dendrite_roomserver.db

# ======================
# SYNC API
# ======================

sync_api:
  database:
    connection_string: file:../../data/dendrite/dendrite_sync.db

# ======================
# USER API
# ======================

user_api:
  account_database:
    connection_string: file:../../data/dendrite/dendrite_user.db

  # No auto-join rooms by default (Vento will manage its own flows)
  auto_join_rooms: []

  # Faster bcrypt for local use
  bcrypt_cost: 8

  worker_count: 4

# ======================
# MSCs disabled
# ======================

mscs:
  mscs: []
  database:
    connection_string: file:../../data/dendrite/dendrite_mscs.db

# ======================
# Appservice API disabled
# ======================

app_service_api:
  config_files: []
  disable_tls_validation: true

# ======================
# Relay API disabled
# ======================

relay_api:
  database:
    connection_string: file:../../data/dendrite/dendrite_relay.db

federation_api:
  database:
    connection_string: file:../../data/dendrite/dendrite_federationapi.db
    max_open_conns: 10
    max_idle_conns: 2
    conn_max_lifetime: -1

  # We're completely disabling federation globally anyway,
  # but keep TLS validation relaxed just in case.
  disable_tls_validation: true
  disable_http_keepalives: false
  send_max_retries: 0
  enable_relays: false
